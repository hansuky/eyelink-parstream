doctype html
html
  head
    meta(charset='utf-8')
    title= title
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(content='width=device-width, initial-scale=1', name='viewport')
    meta(content='', name='description')
    meta(content='', name='author')
    link(href='http://fonts.googleapis.com/css?family=Open+Sans:400,300', rel='stylesheet', type='text/css')
    link(href='/common/assets/fonts/font-awesome/css/font-awesome.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/fonts/simple-line-icons/simple-line-icons.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/css/morris.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/css/bootstrap.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/css/uniform.default.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/css/bootstrap-switch.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/clockface/css/clockface.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/bootstrap-colorpicker/css/colorpicker.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/bootstrap-select/bootstrap-select.min.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/select2/select2.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/plugins/jquery-multi-select/css/multi-select.css', rel='stylesheet', type='text/css')
    link(src='/common/assets/plugins/jquery-ui/jquery-ui.css', type='text/javascript')
    link#style_components(href='/common/assets/css/eyelink-components.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/css/plugins.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/css/eyelink-layout.css', rel='stylesheet', type='text/css')
    link(href='/common/assets/css/eyelink-custom.css', rel='stylesheet', type='text/css')
    link(rel='shortcut icon', href='/common/assets/images/favicon.ico')
    script(src='/common/assets/scripts/libs/jquery.min.js', type='text/javascript')
    script(src="/common/assets/scripts/libs/moment.min.js")
    script(src="/common/assets/scripts/libs/daterangepicker.custom.js")
    script(src="/common/assets/scripts/libs/jquery-confirm.custom.js")
    script(src="/common/assets/scripts/libs/jquery.magnific-popup.min.js")
    script(src="/common/assets/scripts/libs/jquery.knob.min.js")
    script(src="/common/assets/scripts/libs/tooltipster.bundle.min.js")
    script(src="/common/assets/scripts/libs/jquery-clockpicker.min.js")
    script(src="/common/assets/scripts/libs/odometer.min.js")
    script(src="/common/assets/scripts/libs/jquery.cookie.js")
    script(src="/common/assets/scripts/libs/bootstrap-select.min.js")
    script(src="/common/assets/scripts/libs/bootstrap-slider-custom.js")
    script(src="/common/assets/scripts/libs/d3.min.js")
    script(src="/common/scripts/common.js")
    script(src="/common/scripts/util.js")
    script(src='/common/assets/scripts/libs/jquery-migrate.min.js', type='text/javascript')
    script(src='/common/assets/scripts/libs/bootstrap.min.js', type='text/javascript')
    script(src='/common/assets/scripts/libs/bootstrap-hover-dropdown.min.js', type='text/javascript')
    script(src='/common/assets/scripts/libs/jquery.slimscroll.min.js', type='text/javascript')
    script(src='/common/assets/scripts/libs/jquery.blockui.min.js', type='text/javascript')
    script(src='/common/assets/scripts/libs/jquery.uniform.min.js', type='text/javascript')
    script(src='/common/assets/scripts/libs/bootstrap-switch.min.js', type='text/javascript')
    script(src='/common/assets/plugins/jquery-ui/jquery-ui.min.js', type='text/javascript')
    script(src='/common/assets/scripts/jquery.cokie.min.js', type='text/javascript')
    script(src='/common/assets/plugins/charts/morris/morris.min.js', type='text/javascript')
    script(src='/common/assets/plugins/charts/morris/raphael-min.js', type='text/javascript')
    script(src='/common/assets/plugins/charts/jquery.sparkline.min.js', type='text/javascript')
    script(src='/common/assets/plugins/bootstrap-select/bootstrap-select.min.js', type='text/javascript')
    script(src='/common/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js', type='text/javascript')
    script(src='/common/assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js', type='text/javascript')
    script(src='/common/assets/plugins/clockface/js/clockface.js', type='text/javascript')
    script(src='/common/assets/plugins/bootstrap-daterangepicker/moment.min.js', type='text/javascript')
    script(src='/common/assets/plugins/bootstrap-daterangepicker/daterangepicker.js', type='text/javascript')
    script(src='/common/assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js', type='text/javascript')
    script(src='/common/assets/plugins/bootstrap-select/bootstrap-select.min.js', type='text/javascript')
    script(src='/common/assets/plugins/select2/select2.min.js', type='text/javascript')
    script(src='/common/assets/plugins/jquery-multi-select/js/jquery.multi-select.js', type='text/javascript')
    script(src='/common/assets/scripts/eyelink-ui.js', type='text/javascript')
    script(src='/common/assets/scripts/eyelink-layout.js', type='text/javascript')
    script(src='/common/assets/scripts/eyelink-quick-sidebar.js', type='text/javascript')
    script(src='/common/assets/scripts/page/components-pickers.js', type='text/javascript')
    script(src='/common/assets/scripts/page/components-dropdowns.js', type='text/javascript')
    script(src='/common/assets/scripts/page/layout.js', type='text/javascript')
    script(src='/common/assets/scripts/page/demo.js', type='text/javascript')
    script(src='/socket.io/socket.io.js', type='text/javascript')
    block style
    block script
    script.
      var notLoad = true;
      jQuery(document).ready(function() {
        $('#menudashboard').addClass( '#{mainmenu.dashboard}');
        $('#menureports').addClass( '#{mainmenu.reports}');
        $('#menutimeseries').addClass( '#{mainmenu.timeseries}');
        $('#menuanalysis').addClass( '#{mainmenu.analysis}');
        $('#menumanagement').addClass( '#{mainmenu.management}');
        $('#menusettings').addClass( '#{mainmenu.settings}');
        $('#menusample').addClass( '#{mainmenu.sample}');

        $('#btn_logout').click(function() {
          location.href = "/logout";
        });

        Metronic.init(); // init metronic core componets
        eyelinkLayout.init(); // init eyelinklayout
        QuickSidebar.init(); // init quick sidebar
        Layout.init(); // init layout
        Demo.init(); // init index page
        ComponentsPickers.init();
        ComponentsDropdowns.init();

        //- initAlarm();

        //- $('#header_notification_bar').addClass('open').trigger('classChange');

        $("#header_notification_bar").on('click', function() {
          //- console.log("#header_notification_bar click");
        });

        $("#header_notification_bar").on('mouseover', function() {
          //- console.log('mouseover');
          if (notLoad) {
            notLoad = false;
            displayAlarmData();
          }
        });
      });

      function initAlarm() {
        var socket = io.connect();
        socket.on('returnAlarmData', function (data) {
          //- alert(data);
          //- console.log(data);
          changeAlarmCount(data.count);
        });

        //- socket.emit('receiveAlarmData', 'initAlarm');
      }

      function changeAlarmCount(count) {
          $("#alarmCount").html(count);
          $("#alarmCount2").html(count + ' pending notifications');
      }

      function displayAlarmData() {
        $.ajax({
          url: "/management/restapi/getAlarmList" ,
          dataType: "json",
          type: "get",
          data: {
            index : "management",
            type : "menu"
          },
          success: function(result) {
            if (result.rtnCode.code == "0000") {
              //- console.log(result.rtnData);
              changeAlarmCount(result.rtnCount);
              drawAlarmList(result.rtnData);
            } else {
              //- $("#errormsg").html(result.message);
            }
            notLoad = true;
          },
          error: function(req, status, err) {
            //- alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
            $("#errormsg").html("code:"+status+"\n"+"message:"+req.responseText+"\n"+"error:"+err);
            notLoad = true;
          }
        });

      }

      function drawAlarmList(data){
        $('#alarmList').empty();

        var sb = new StringBuffer();
        data.forEach(function(d){
          d = d._source;
          sb.append('<li><a>');
          sb.append('<span class="details"><span class="label label-sm label-icon label-success"><i class="fa fa-plus"></i></span>');
          sb.append(d.message);
          sb.append('</span><span class="time">');
          sb.append(d.timestamp);
          sb.append('</sapn></a></li>');
        });
        console.log(sb.toString());
        $('#alarmList').append(sb.toString());
      }
  body.page-header-fixed.page-quick-sidebar-over-content
    .wrapper
      header.page-header
        nav.navbar.mega-menu(role='navigation')
          .container-fluid
            .clearfix.navbar-fixed-top
              button.navbar-toggle(type='button', data-toggle='collapse', data-target='.navbar-responsive-collapse')
                span.sr-only Toggle navigation
                span.toggle-icon
                  span.icon-bar
                  span.icon-bar
                  span.icon-bar
              a#index.page-logo(href='/')
                h1= title
              form.search(action='', method='GET')
                input.form-control(type='name', name='query', placeholder='Search...')
                a.btn.submit(href='javascript:;')
                  i.fa.fa-search
              .topbar-actions
                #header_notification_bar.btn-group-notification.btn-group
                  button.btn.btn-sm.dropdown-toggle(type='button', data-toggle='dropdown', data-hover='dropdown', data-close-others='true')
                    i.icon-bell
                    span#alarmCount.badge 0
                  ul.dropdown-menu-v2
                    li.external
                      h3
                        span#alarmCount2.bold 0 pending notifications
                      a(href='#') view all
                    li
                      ul#alarmList.dropdown-menu-list.scroller(style='height: 250px; padding: 0;', data-handle-color='#637283')
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-success
                                i.fa.fa-plus
                              | Add new datasheet.
                            span.time just now
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-danger
                                i.fa.fa-bolt
                              | Server #12 overloaded.
                            span.time 3 mins
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-warning
                                i.fa.fa-bell-o
                              | Server #2 not responding.
                            span.time 10 mins
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-info
                                i.fa.fa-bullhorn
                              | Application error.
                            span.time 14 hrs
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-danger
                                i.fa.fa-bolt
                              |  Database overloaded 68%.
                            span.time 2 days
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-danger
                                i.fa.fa-bolt
                              |  A user IP blocked.
                            span.time 3 days
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-warning
                                i.fa.fa-bell-o
                              |  Storage Server #4 not responding.
                            span.time 4 days
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-info
                                i.fa.fa-bullhorn
                              |  System Error.
                            span.time 5 days
                        li
                          a(href='javascript:;')
                            span.details
                              span.label.label-sm.label-icon.label-danger
                                i.fa.fa-bolt
                              |  Storage server failed.
                            span.time 9 days
                .btn-group-add.btn-group
                  button.btn.btn-sm.dropdown-toggle(type='button', data-toggle='dropdown', data-hover='dropdown', data-close-others='true')
                    i.icon-plus
                  ul.dropdown-menu-v2(role='menu')
                    li.active
                      a(href='#') New Schedule
                    li
                      a(href='#') New Datasheet
                    li
                      a(href='#') New Task
                    li.divider
                    li
                      a(href='#')
                        | Comments
                        span.badge.badge-success 4
                    li
                      a(href='#')
                        | Feedbacks
                        span.badge.badge-danger 2
                .btn-group-user.btn-group
                  button.btn.btn-sm.dropdown-toggle(type='button', data-toggle='dropdown', data-hover='dropdown', data-close-others='true')
                    i.icon-user
                    span Damon kim
                  ul.dropdown-menu-v2(role='menu')
                    li.active
                      a(href='#')
                        | My Profile
                        span.badge.badge-danger 1
                    li
                      a(href='#')
                        | My Schedule
                        span.badge.badge-info 3
                    li
                      a(href='#') My Tasks
                    li.divider
                    li
                      a(href='index.html') Log Out
                button#btn_logout.quick-sidebar-toggler(type='button', data-toggle='collapse')
                  span.sr-only Toggle Quick Sidebar
                  i.icon-logout
            .nav-collapse.collapse.navbar-collapse.navbar-responsive-collapse
              ul.nav.navbar-nav.text-uppercase
                li#menudashboard.dropdown.dropdown-fw
                  a(href='javascript:;') DASHBOARD
                  ul.dropdown-menu.dropdown-menu-fw
                    li
                      a(href='/dashboard/') Dashboard
                li#menutimeseries.dropdown.dropdown-fw
                  a(href='javascript:;') timeseries
                  ul.dropdown-menu.dropdown-menu-fw
                    li
                      a(href='/timeseries/') timeseries
                li#menuanalysis.dropdown.dropdown-fw
                  a(href='javascript:;') ANALYSIS
                  ul.dropdown-menu.dropdown-menu-fw
                    li
                      a(href='/analysis/anomaly/') Anomaly
                    li
                      a(href='/analysis/pattern') Pattern Management
                    li
                      a(href='/analysis/patternMatching') Pattern Matching
                li#menumanagement.dropdown.dropdown-fw
                  a(href='javascript:;') Management
                  ul.dropdown-menu.dropdown-menu-fw
                    li
                      a(href='/management/recipe') Recipes
      block content
