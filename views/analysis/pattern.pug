extends ../layout-type01
block style
  link(rel='stylesheet', type='text/css', href='/assets/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css')
  link(rel='stylesheet', href='/stylesheets/style.css')
  link(href='/assets/bootstrap-treeview/bootstrap-treeview.css', rel='stylesheet', type='text/css')

block script
  script(type='text/javascript', src="/scripts/util.js")
  script(type='text/javascript', src='/assets/plugins/datatables/media/js/jquery.dataTables.min.js')
  script(type='text/javascript', src='/assets/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js')
  script(src='/assets/scripts/page/table-managed.js')  
  
  script(type='text/javascript', src='/assets/leaflet/d3.js')
  script(src='/assets/annie/js/vue.min.js')
  script(type='text/javascript', src='/assets/annie/js/colorbrewer.js')
  
  script(src='/assets/bootstrap-treeview/bootstrap-treeview.js', type='text/javascript')
  script(type='text/javascript', src="/scripts/analysis_pattern.js")

  script.
    $(document).ready(function() {
      var dateFormat = 'YYYY-MM-DD';      
      $('#sdate').val(moment().format(dateFormat));
      $('#edate').val(moment().format(dateFormat));
      getPatternList() // pattern dataset
      

      //- $('#btn_search').click(function() {
      //-   d3.selectAll("svg").remove();
      //-   getPatternList() // pattern dataset
      //- });

      $('#btnCheckedUpdate').click(function() {
        console.log("checkbox test");
        //updateCheckedAll();
        var checkbox = $("input[name=patternChk]:checked");
        var numOfCheck = $("input[name=patternChk]:checked").length;
        console.log(numOfCheck);
        
        if(numOfCheck == 0) {
          console.log("There is no checked item");
        }
        else{
          if(confirm(numOfCheck + "개 항목에 대해 일괄저장 하시겠습니까?")){
            var id = $('#lblCreatedDate').text();
            var queryBody = {};
            var tr = checkbox.parent().parent();
            var fG = tr.children().eq(1).text();
            queryBody[fG] = {};

            checkbox.each(function(i) {
              var td = tr.eq(i).children();
              var cN = td.eq(2).text();
              queryBody[fG][cN] = td.eq(3).children().val();
            });

            console.log(queryBody);

            $.ajax({
              url: "/analysis/restapi/pattern_info/" + id + "/_update",
              dataType: "json", type: "POST", data: queryBody,
              success: function(result) {
                alert('(' + result.rtnCode.code + ')' +result.rtnCode.message);
                if (result.rtnCode.code == "D002") {
                  var nodeInfo = $('#patternTree').treeview('getSelected');
                  loadPatternData(id, nodeInfo[0]);
                }
              },
              error: function(req, status, err) {
                $("#errormsg").html("code:"+status+"\n"+"message:"+req.responseText+"\n"+"error:"+err);
              }
            });
          }
        }
      });

      
      // Click creation date
      clickLinkFunc = function(link) {
        $('#tblPatterns > tbody').empty();
        d3.selectAll("svg").remove();
        var creationDate = link.innerText || link.textContent;
        //$('#creationDate').val(creationDate);
        $("#lblCreatedDate").empty();
        $("#lblCreatedDate").append(creationDate);

        console.log(creationDate);
        d3.selectAll("svg").remove();
        loadPatternData(creationDate);
      };

      

      // getPatternList();  

      Metronic.init(); // init metronic core componets
      eyelinkLayout.init(); // init eyelinklayout
      QuickSidebar.init(); // init quick sidebar
      Layout.init(); // init layout
      Demo.init(); // init index page
      ComponentsPickers.init();
      TableManaged.init();
      ComponentsDropdowns.init();
    });

block content
  .container-fluid
    .page-content
      .breadcrumbs
        h1 Pattern management
        ol.breadcrumb
          li
            a(href='/dashboard') Home
          li
            a(href='#') Analysys
          li.active Pattern management
      .row
        .col-md-12
          .portlet.light.bordered
            .portlet-title
              .caption.font-dark
                span.caption-subject.bold.uppercase.font-blue-sharp Date selection
            .portlet-body.form
              form.form-horizontal.form-bordered(onsubmit="return false;")
                .form-body
                  .row
                    label.control-label.col-md-1 Date Range
                    .col-md-3
                      .input-group.input-large.date-picker.input-daterange(data-date='2017-01-01', data-date-format='yyyy-mm-dd')
                        input#sdate.form-control(type='text', name='from' value='')
                        span.input-group-addon to
                        input#edate.form-control(type='text', name='to' value='')
                    .col-md-1.form-inline
                      button#btn_search.btn.blue
                        i.fa.fa-search  Search
      .row
        .col-md-2
          .portlet.light.bordered(style='height: 730px;')
            .portlet-title
              .caption.font-dark
                span.caption-subject.bold.uppercase Pattern list
                span.caption-helper  By Created date
            .portlet-body
              .scroller(style='height: 730px;', data-always-visible='1', data-rail-visible='0')
                table#patternList.table.table-hover.table-light
        .col-md-2
          .portlet.light.bordered.tasks-widget(style='height:730px;')
            .portlet-title
              .caption
                span.caption-subject.bold.uppercase.font-green-haze Pattern Group
                span.caption-helper  Created Patterns at  
                label#lblCreatedDate  
            .portlet-body
              .scroller(style='height: 600px;', data-always-visible='1', data-rail-visible='0')
                #patternTree
        .col-md-4
          .portlet.light(style='height:730px;')
            .portlet-title
              .caption
                span.caption-subject.bold.uppercase.font-green-haze Patterns
                span.caption-helper  Detail information about selected patterns
              .tools
                button#btnCheckedUpdate.btn.blue
                  i.fa  checked update
            .portlet-body
              .scroller(style='height: 600px;', data-always-visible='1', data-rail-visible='0')
                table#tblPatterns.table.table-striped.table-bordered.table-hover
                  thead
                    tr
                      th(style='text-align:center;')  
                      th(style='text-align:center;')  Group
                      th(style='text-align:center;')  Cluster No.
                      th(style='text-align:center;')  Status
                      th(style='text-align:center;')
                  tbody
        .col-md-4
          .portlet.light.bordered.tasks-widget(style='height:500px;')
            .portlet-title
              .caption
                span.caption-subject.bold.uppercase.font-green-haze Segment
                span.caption-helper  Pattern shape(120 minutes)
              .tools
                a.collapse(href='javascript:;')
                a.config(href='#portlet-config', data-toggle='modal')
                a.reload(href='javascript:;')
                a.fullscreen(href='javascript:;')
                a.remove(href='javascript:;')
            .portlet-body
              //- 차트 들어갈 부분
              .chart(style='height:500px;')
                #patternChart